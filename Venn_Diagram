library("limma")
library("qvalue")
library("OrgMassSpecR")
library("biomaRt")
library("Hmisc")
library("gplots")
library("rpx")
library("mzR")
library("OrgMassSpecR")
library("biomaRt")
library("Hmisc")
library("gplots")
library("isobar") 
library("devtools")
library("MSnbase")
library("Biobase")
library("dplyr")
library("tidyverse")
library("fs")
library("proxyC")
library("sjlabelled")
library("expss")
library("labelled")
library("patchwork")
library("msdata")
library("remotes")
library("janitor")
library("stringr")
library("ggvenn")
library("ggVennDiagram")

wd <- setwd("/Users/jensvandeperre/Desktop/Inputs/ALL_mzTab")
getwd() 
list.files(wd)
    #Automate filename extraction
(file_name_long <- list.files(wd))
(file_paths <- fs::dir_ls("/Users/jensvandeperre/Desktop/Inputs/ALL_mzTab"))
(file_names_short <- substring(file_name_long, 39, 46)) 
length(file_names_short)

#Original study psms
    #Load in original studies
(file_paths_ori_study <- fs::dir_ls("/Users/jensvandeperre/Desktop/Inputs/Orig_study_PSMs"))
ori_study <- list()
for (i in seq_along(file_paths_ori_study)) {
    ori_study[[i]] <- read.csv(file_paths_ori_study[[i]], header = FALSE, sep = "\t")
}
    #Select sequences
orig <- list()
for (i in 1:264) {
orig[[i]] <- ori_study[[i]] %>%
        as_tibble() %>%
        row_to_names(row_number = 1) %>%
        select(PeptideSequence) %>%
        mutate(sequence = trimws(str_remove_all(PeptideSequence, "[[:digit:]]+"))) %>%
        mutate(sequence = trimws(str_remove_all(sequence, "[+.]"))) %>%
        select(sequence)
}
Ori_Stud <- set_names(orig, paste("Original_study_", file_names_short, sep = "")) #names each file by file_names_short
view(Ori_Stud[[1]])
    #Turn into 1 dataframe
Original_study <- bind_rows(Ori_Stud)
view(Original_study)
nrow(Original_study)

#ANN-SoLo PSMs 
    #Load list of dataframes, all identifed peptides
PSM <- readRDS("/Users/jensvandeperre/Desktop/Outputs/PSMs/ALL_PSMs_4.5.22")
view(PSM[[1]])
    #Select sequences
annsolo <- list()
for (i in 1:264) {
    annsolo[[i]] <- PSM[[i]] %>%
        select(sequence_no_mod)
}
ANN_SoLo_no_mod <- bind_rows(annsolo)
nrow(ANN_SoLo_no_mod) #Over 4.5 million peptides identified

    #Load dataframes, only modified peptides
file_paths_annsolo_mod <- fs::dir_ls("/Users/jensvandeperre/Desktop/Outputs/PTM_identification_tol_10")
PSM_only_mod <- list()
for (i in seq_along(file_paths_annsolo_mod)) {
    PSM_only_mod[[i]] <- read.csv(file_paths_annsolo_mod[[i]], header = FALSE, sep = ",") 
}
view(PSM_only_mod[[1]])
    #Select sequences
annsolo_mod <- list()
for (i in 1:264) {
    annsolo_mod[[i]] <- PSM_only_mod[[i]] %>%
    row_to_names(row_number = 1) %>%
    slice(-c("")) %>%
    select(sequence) %>%     
    mutate(sequence = trimws(str_remove_all(sequence, "n"))) %>% #remove n
    mutate(sequence = trimws(str_remove_all(sequence, "[0123456789]"))) %>% # remove numbers
    mutate(sequence = trimws(str_remove_all(sequence, "\\[|\\]"))) 
}
view(annsolo_mod[[1]])
ANN_SoLo_only_mod <- bind_rows(annsolo_mod)
nrow(ANN_SoLo_only_mod)

#Creating Venn Diagram 
    #Coparing all ANN-SoLo peptides to original study
ANN_vs_ORG <- list(
    ANN_SoLo = as.vector(unlist(ANN_SoLo_no_mod)),
    Original_study = as.vector(unlist(Original_study))
)
ggvenn(ANN_vs_ORG)
ggVennDiagram(ANN_vs_ORG)

    #Comparing only the modified peptides to original study
ANNMOD_vs_ORG <- list (
    ANN_SoLo_modified_peptides = as.vector(unlist(ANN_SoLo_only_mod)),
    Original_study = as.vector(unlist(Original_study))
)
ggvenn(ANNMOD_vs_ORG)
ggVennDiagram(ANNMOD_vs_ORG)


